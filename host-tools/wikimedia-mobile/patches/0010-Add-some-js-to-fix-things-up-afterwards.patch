From 0b9e68bc0cf637ef11aff6ad10923152f01d9f4b Mon Sep 17 00:00:00 2001
From: Holger Hans Peter Freyther <zecke@selfish.org>
Date: Thu, 19 Mar 2009 15:15:21 +0800
Subject: [PATCH] Add some js to fix things up afterwards..

---
 app/views/layout/_fixup.html.haml      |   22 ++++++++++++++++++++++
 app/views/layout/application.html.haml |    1 +
 2 files changed, 23 insertions(+), 0 deletions(-)
 create mode 100644 app/views/layout/_fixup.html.haml

diff --git a/app/views/layout/_fixup.html.haml b/app/views/layout/_fixup.html.haml
new file mode 100644
index 0000000..d11e34d
--- /dev/null
+++ b/app/views/layout/_fixup.html.haml
@@ -0,0 +1,22 @@
+- if @article
+  - if request.device.supports_javascript
+    :javascript
+       // Hide all images
+       var nodes = document.querySelectorAll("a")
+       for (i = 0; i < nodes.length; ++i) {
+           if (nodes[i].href.indexOf("/mediawiki/index.php/Image:") != -1 ||
+               nodes[i].href.indexOf("/mediawiki/index.php/File:")  != -1) {
+               nodes[i].style.setProperty("display", "none");
+           }
+       }
+
+       // Twist things around....
+       var nodes = document.querySelectorAll("div.references-small")
+       for (i = 0; i < nodes.length; ++i) {
+           var column = nodes[i].style.getPropertyValue("-webkit-column-count")
+           if (column != null) {
+               nodes[i].style.setProperty("-webkit-column-count", "1")
+           }
+       }
+
+
diff --git a/app/views/layout/application.html.haml b/app/views/layout/application.html.haml
index 6662454..5f5dc73 100644
--- a/app/views/layout/application.html.haml
+++ b/app/views/layout/application.html.haml
@@ -14,4 +14,5 @@
       = catch_content :for_layout
     #footer
       = language_object["copyright"]
+  = partial "layout/fixup" if request.device.supports_javascript
       
-- 
1.5.6.3

