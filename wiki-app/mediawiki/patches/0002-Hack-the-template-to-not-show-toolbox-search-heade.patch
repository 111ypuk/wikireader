From 1dec8bc64d149f8c77acca720ddf9939687967ab Mon Sep 17 00:00:00 2001
From: Holger Freyther <ich@holger-freythers-macbook-pro.local>
Date: Tue, 4 Nov 2008 23:44:36 +0100
Subject: [PATCH 02/22] Hack the template to not show toolbox, search, header, or anything else

---
 includes/SkinTemplate.php  |   16 ++++++-
 includes/parser/Parser.php |    2 +
 skins/MonoBook.php         |  110 +-------------------------------------------
 3 files changed, 17 insertions(+), 111 deletions(-)

diff --git a/includes/SkinTemplate.php b/includes/SkinTemplate.php
index f6d716a..57ed730 100644
--- a/includes/SkinTemplate.php
+++ b/includes/SkinTemplate.php
@@ -258,8 +258,10 @@ class SkinTemplate extends Skin {
 		$tpl->set( "protect", count($this->mTitle->isProtected()) ? "unprotect" : "protect" );
 		$tpl->set( "helppage", wfMsg('helppage'));
 		*/
+/*
 		$tpl->set( 'searchaction', $this->escapeSearchLink() );
 		$tpl->set( 'search', trim( $wgRequest->getVal( 'search' ) ) );
+*/
 		$tpl->setRef( 'stylepath', $wgStylePath );
 		$tpl->setRef( 'articlepath', $wgArticlePath );
 		$tpl->setRef( 'scriptpath', $wgScriptPath );
@@ -445,8 +447,10 @@ class SkinTemplate extends Skin {
 			$tpl->set('body_ondblclick', false);
 		}
 		$tpl->set( 'body_onload', false );
+/*
 		$tpl->set( 'sidebar', $this->buildSidebar() );
 		$tpl->set( 'nav_urls', $this->buildNavUrls() );
+*/
 
 		// original version by hansm
 		if( !wfRunHooks( 'SkinTemplateOutputPageBeforeExec', array( &$this, &$tpl ) ) ) {
@@ -556,6 +560,7 @@ class SkinTemplate extends Skin {
 				: 'login';
 			if( $this->showIPinHeader() ) {
 				$href = &$this->userpageUrlDetails['href'];
+/*
 				$personal_urls['anonuserpage'] = array(
 					'text' => $this->username,
 					'href' => $href,
@@ -575,17 +580,21 @@ class SkinTemplate extends Skin {
 					'href' => self::makeSpecialUrl( 'Userlogin', 'returnto=' . $this->thisurl ),
 					'active' => $wgTitle->isSpecial( 'Userlogin' )
 				);
+*/
 			} else {
-
+/*
 				$personal_urls['login'] = array(
 					'text' => wfMsg( $loginlink ),
 					'href' => self::makeSpecialUrl( 'Userlogin', 'returnto=' . $this->thisurl ),
 					'active' => $wgTitle->isSpecial( 'Userlogin' )
 				);
+*/
 			}
 		}
 
+/*
 		wfRunHooks( 'PersonalUrls', array( &$personal_urls, &$wgTitle ) );
+*/
 		wfProfileOut( __METHOD__ );
 		return $personal_urls;
 	}
@@ -850,8 +859,10 @@ class SkinTemplate extends Skin {
 		global $wgUseTrackbacks, $wgTitle, $wgUser, $wgRequest;
 		global $wgEnableUploads, $wgUploadNavigationUrl;
 
-		wfProfileIn( __METHOD__ );
+		return array();
 
+/*
+		wfProfileIn( __METHOD__ );
 		$action = $wgRequest->getVal( 'action', 'view' );
 
 		$nav_urls = array();
@@ -953,6 +964,7 @@ class SkinTemplate extends Skin {
 			);
 		}
 		wfProfileOut( __METHOD__ );
+        */
 		return $nav_urls;
 	}
 
diff --git a/includes/parser/Parser.php b/includes/parser/Parser.php
index f60ed17..8d331d3 100644
--- a/includes/parser/Parser.php
+++ b/includes/parser/Parser.php
@@ -3384,9 +3384,11 @@ class Parser
 
 		# Allow user to stipulate that a page should have a "new section"
 		# link added via __NEWSECTIONLINK__
+/*
 		if ( isset( $this->mDoubleUnderscores['newsectionlink'] ) ) {
 			$this->mOutput->setNewSection( true );
 		}
+*/
 
 		# Allow user to remove the "new section"
 		# link via __NONEWSECTIONLINK__
diff --git a/skins/MonoBook.php b/skins/MonoBook.php
index 366199d..b75ed43 100644
--- a/skins/MonoBook.php
+++ b/skins/MonoBook.php
@@ -110,8 +110,7 @@ class MonoBookTemplate extends QuickTemplate {
 <body<?php if($this->data['body_ondblclick']) { ?> ondblclick="<?php $this->text('body_ondblclick') ?>"<?php } ?>
 <?php if($this->data['body_onload']) { ?> onload="<?php $this->text('body_onload') ?>"<?php } ?>
  class="mediawiki <?php $this->text('dir') ?> <?php $this->text('pageclass') ?> <?php $this->text('skinnameclass') ?>">
-	<div id="globalWrapper">
-		<div id="column-content">
+	<div id="globalWrapper" display="none">
 	<div id="content">
 		<a name="top" id="top"></a>
 		<?php if($this->data['sitenotice']) { ?><div id="siteNotice"><?php $this->html('sitenotice') ?></div><?php } ?>
@@ -119,120 +118,13 @@ class MonoBookTemplate extends QuickTemplate {
 		<div id="bodyContent">
 			<h3 id="siteSub"><?php $this->msg('tagline') ?></h3>
 			<div id="contentSub"><?php $this->html('subtitle') ?></div>
-			<?php if($this->data['undelete']) { ?><div id="contentSub2"><?php     $this->html('undelete') ?></div><?php } ?>
-			<?php if($this->data['newtalk'] ) { ?><div class="usermessage"><?php $this->html('newtalk')  ?></div><?php } ?>
-			<?php if($this->data['showjumplinks']) { ?><div id="jump-to-nav"><?php $this->msg('jumpto') ?> <a href="#column-one"><?php $this->msg('jumptonavigation') ?></a>, <a href="#searchInput"><?php $this->msg('jumptosearch') ?></a></div><?php } ?>
 			<!-- start content -->
 			<?php $this->html('bodytext') ?>
 			<?php if($this->data['catlinks']) { $this->html('catlinks'); } ?>
 			<!-- end content -->
-			<?php if($this->data['dataAfterContent']) { $this->html ('dataAfterContent'); } ?>
 			<div class="visualClear"></div>
 		</div>
 	</div>
-		</div>
-		<div id="column-one">
-	<div id="p-cactions" class="portlet">
-		<h5><?php $this->msg('views') ?></h5>
-		<div class="pBody">
-			<ul>
-	<?php		foreach($this->data['content_actions'] as $key => $tab) {
-					echo '
-				 <li id="' . Sanitizer::escapeId( "ca-$key" ) . '"';
-					if( $tab['class'] ) {
-						echo ' class="'.htmlspecialchars($tab['class']).'"';
-					}
-					echo'><a href="'.htmlspecialchars($tab['href']).'"';
-					# We don't want to give the watch tab an accesskey if the
-					# page is being edited, because that conflicts with the
-					# accesskey on the watch checkbox.  We also don't want to
-					# give the edit tab an accesskey, because that's fairly su-
-					# perfluous and conflicts with an accesskey (Ctrl-E) often
-					# used for editing in Safari.
-				 	if( in_array( $action, array( 'edit', 'submit' ) )
-				 	&& in_array( $key, array( 'edit', 'watch', 'unwatch' ))) {
-				 		echo $skin->tooltip( "ca-$key" );
-				 	} else {
-				 		echo $skin->tooltipAndAccesskey( "ca-$key" );
-				 	}
-				 	echo '>'.htmlspecialchars($tab['text']).'</a></li>';
-				} ?>
-			</ul>
-		</div>
-	</div>
-	<div class="portlet" id="p-personal">
-		<h5><?php $this->msg('personaltools') ?></h5>
-		<div class="pBody">
-			<ul>
-<?php 			foreach($this->data['personal_urls'] as $key => $item) { ?>
-				<li id="<?php echo Sanitizer::escapeId( "pt-$key" ) ?>"<?php
-					if ($item['active']) { ?> class="active"<?php } ?>><a href="<?php
-				echo htmlspecialchars($item['href']) ?>"<?php echo $skin->tooltipAndAccesskey('pt-'.$key) ?><?php
-				if(!empty($item['class'])) { ?> class="<?php
-				echo htmlspecialchars($item['class']) ?>"<?php } ?>><?php
-				echo htmlspecialchars($item['text']) ?></a></li>
-<?php			} ?>
-			</ul>
-		</div>
-	</div>
-	<div class="portlet" id="p-logo">
-		<a style="background-image: url(<?php $this->text('logopath') ?>);" <?php
-			?>href="<?php echo htmlspecialchars($this->data['nav_urls']['mainpage']['href'])?>"<?php
-			echo $skin->tooltipAndAccesskey('p-logo') ?>></a>
-	</div>
-	<script type="<?php $this->text('jsmimetype') ?>"> if (window.isMSIE55) fixalpha(); </script>
-<?php
-		$sidebar = $this->data['sidebar'];
-		if ( !isset( $sidebar['SEARCH'] ) ) $sidebar['SEARCH'] = true;
-		if ( !isset( $sidebar['TOOLBOX'] ) ) $sidebar['TOOLBOX'] = true;
-		if ( !isset( $sidebar['LANGUAGES'] ) ) $sidebar['LANGUAGES'] = true;
-		foreach ($sidebar as $boxName => $cont) {
-			if ( $boxName == 'SEARCH' ) {
-				$this->searchBox();
-			} elseif ( $boxName == 'TOOLBOX' ) {
-				$this->toolbox();
-			} elseif ( $boxName == 'LANGUAGES' ) {
-				$this->languageBox();
-			} else {
-				$this->customBox( $boxName, $cont );
-			}
-		}
-?>
-		</div><!-- end of the left (by default at least) column -->
-			<div class="visualClear"></div>
-			<div id="footer">
-<?php
-		if($this->data['poweredbyico']) { ?>
-				<div id="f-poweredbyico"><?php $this->html('poweredbyico') ?></div>
-<?php 	}
-		if($this->data['copyrightico']) { ?>
-				<div id="f-copyrightico"><?php $this->html('copyrightico') ?></div>
-<?php	}
-
-		// Generate additional footer links
-		$footerlinks = array(
-			'lastmod', 'viewcount', 'numberofwatchingusers', 'credits', 'copyright',
-			'privacy', 'about', 'disclaimer', 'tagline',
-		);
-		$validFooterLinks = array();
-		foreach( $footerlinks as $aLink ) {
-			if( isset( $this->data[$aLink] ) && $this->data[$aLink] ) {
-				$validFooterLinks[] = $aLink;
-			}
-		}
-		if ( count( $validFooterLinks ) > 0 ) {
-?>			<ul id="f-list">
-<?php
-			foreach( $validFooterLinks as $aLink ) {
-				if( isset( $this->data[$aLink] ) && $this->data[$aLink] ) {
-?>					<li id="<?php echo$aLink?>"><?php $this->html($aLink) ?></li>
-<?php 			}
-			}
-?>
-			</ul>
-<?php	}
-?>
-		</div>
 </div>
 <?php $this->html('bottomscripts'); /* JS call to runBodyOnloadHook */ ?>
 <?php $this->html('reporttime') ?>
-- 
1.6.1

