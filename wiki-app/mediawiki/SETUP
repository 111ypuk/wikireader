= Setting up MediaWiki =

== Installation on a Ubuntu system ==

=== Get a MediaWiki ===
I have phase3 from svn trunk. A released version should work too. We have some
patches that you need to apply, they are mostly responsible for generating output
in the way we want it.

=== Base install ===
sudo aptitude install php5-cgi
sudo aptitude install cherokee
sudo aptitude install mime-support php5 php5-mysql mysql-server
svn co http://svn.wikimedia.org/svnroot/mediawiki/trunk/phase3
chmod a+w phase3/config
sudo vim /etc/cherokee/sites-enabled/mediawiki and put the below there
    Directory /mediawiki {
              Handler common
              DocumentRoot /dir/to/phase3-trunk
    }

sudo /etc/init.d/apache2 stop
sudo /etc/inid.d/cherokee restart

=== Verify the base installation ===
open http://127.0.0.1/mediawiki/config/index.php to test the installation. Do
you see a setup page?

=== Configuring mysqlserver ===
    /etc/mysql/debian.cnf contains the admin user and pw for mysqld
    mysql -u debian-sys-maint -p
    mysql>create database wikidb;
    mysql>grant create,select, insert, update, delete, lock tables on wikidb.* to  'wikiuser'@'localhost' identified by 'PASSWORD';

=== Complete the configuration ===
    Go to http:/127.0.0.1/mediawiki/config/index.php and configure, do not set a database
    prefix as MWDump can not handle it.

    mv the LocalSettings.php to the right place (the above website will tell you)


= Importing a dump =
== Getting a dump ==
You will need the pages and the images. Google for enwiki-latest-pages.articles.xml.bz2
and download whatever you need.


	 http://download.wikimedia.org/enwiki/latest/enwiki-latest-pages-articles.xml.bz2 

== Deleting/Wiping tables ==
You want to clean the text and article table (remove the Main_Page). You can do this
with
  mysql -u wikiuser -p wikidb
  PASSWORD

  >show tables;
  >delete from text;
  >delete from page;

This will help to make the below import work properly

== Using the scripts ==
  http://www.mediawiki.org/wiki/MWDumper and importing the SQL dumps is
  supposed to be faster. This means that you need to configure mediawiki
  without a db prefix. But also split the content otherwise java will take
  all your memory.

    java -jar mwdumper.jar --format=sql:1.5 enwiki-latest-pages-articles.xml.bz2 > wiki_sql_dump
    cat wiki_sql_dump | mysql -u wikiuser -p wikidb
    
    The wiki_sql_dump will be close to 16gb of size.

  http://meta.wikimedia.org/wiki/Data_dump has some stuff on how to install
  "tidy" to have less messed up display of the pages. Also look at the
  extensions one needs to install besides Tidy.

   # To generate interwiki data
   cat data/interwiki-links.sql | mysql -u wikiuser -p wikidb 

   # Alternatively do
   download the inrerwiki.sql.gz from the dump you are using
   gunzip
   remove drop table, alter table from the sql
   mysql -u wikiuser -p wikidb
   >delete from interwiki;
   >CTRL+D
   cat interwiki.sql | mysql -u wikiuser -p wikidb


= Setting up/tuning mediawiki =
== Installation extensions ==
Your MediaWiki needs to enable certain extensions:

    I have a mediawiki and the extensions from trunk and symlinks work fine

    extensions/Citation -> ../../for-zecke/extensions-trunk/Citation
    extensions/Cite -> ../../for-zecke/extensions-trunk/Cite
    extensions/ImageMap -> ../../for-zecke/extensions-trunk/ImageMap
    extensions/ParserFunctions -> ../../for-zecke/extensions-trunk/ParserFunctions
    extensions/Purge -> ../../for-zecke/extensions-trunk/Purge
    extensions/README
    extensions/tidy -> ../../for-zecke/extensions-trunk/tidy

    And you need to enable some of them manually in the LocalSettings.php placed at the bottom.

    $wgUseTidy = true;
    $wgTidyBin = '/space/dports/bin/tidy';
    $wgTidyConf = $IP.'/extensions/tidy/tidy.conf';
    $wgExtraNamespaces = array(100 => "Portal", 101 => "Portal_talk");

    require_once( "$IP/extensions/ParserFunctions/ParserFunctions.php" );
    require_once( "$IP/extensions/Cite/Cite.php" );
    require_once( "$IP/extensions/ImageMap/ImageMap.php" );

= Post processing =
Some templates seem to be missing. Like Template:·, Template:·w we might
need to import that by copy and paste or special mysql dumps ourselves...
Also it needs verification where t goes missing.

For the final content Template:Navbox needs to be changed to not have
auto collapsable tables, we need to expand them by default.
